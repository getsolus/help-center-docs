"use strict";(self.webpackChunksolus_help_center=self.webpackChunksolus_help_center||[]).push([["5462"],{15670:function(e,t,a){a.r(t),a.d(t,{frontMatter:()=>o,toc:()=>d,default:()=>p,metadata:()=>n,assets:()=>l,contentTitle:()=>r});var n=JSON.parse('{"id":"packaging/appstream-metainfo","title":"Appstream Metainfo","description":"AppStream metainfo is required for all graphical applications in the Solus repository.","source":"@site/docs/packaging/appstream-metainfo.md","sourceDirName":"packaging","slug":"/packaging/appstream-metainfo","permalink":"/docs/packaging/appstream-metainfo","draft":false,"unlisted":false,"editUrl":"https://github.com/getsolus/help-center-docs/tree/master/docs/packaging/appstream-metainfo.md","tags":[],"version":"current","lastUpdatedAt":1764392561000,"frontMatter":{"title":"Appstream Metainfo","summary":"The purpose and format of Appstream Metainfo"},"sidebar":"packagingSidebar","previous":{"title":"Local Repository","permalink":"/docs/packaging/advanced-config/local-repository"},"next":{"title":"Git Basics","permalink":"/docs/packaging/git-basics"}}'),i=a(74848),s=a(84429);let o={title:"Appstream Metainfo",summary:"The purpose and format of Appstream Metainfo"},r="AppStream Metainfo",l={},d=[{value:"A short note on terminology",id:"a-short-note-on-terminology",level:2},{value:"Adding appstream metainfo to an existing package",id:"adding-appstream-metainfo-to-an-existing-package",level:2},{value:"Testing appstream metainfo",id:"testing-appstream-metainfo",level:2},{value:"Debugging failures",id:"debugging-failures",level:2},{value:"Writing AppStream metainfo",id:"writing-appstream-metainfo",level:2},{value:"Running <code>appstream-generator</code>",id:"running-appstream-generator",level:2}];function c(e){let t={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"appstream-metainfo",children:"AppStream Metainfo"})}),"\n",(0,i.jsx)(t.admonition,{type:"important",children:(0,i.jsx)(t.p,{children:"AppStream metainfo is required for all graphical applications in the Solus repository."})}),"\n",(0,i.jsx)(t.p,{children:"AppStream allows upstream projects to define metadata about the components they provide using small XML files, metainfo files, which get installed into locations on the client system and are used by distributors to enhance their metadata."}),"\n",(0,i.jsx)(t.p,{children:"AppStream metainfo has become a requirement for all graphical application in Solus repository because software centers such as GNOME Software and KDE Discover rely on it to display applications that are available in the repository. AppStream metainfo should be shipped by the upstream project, bundled in with its source, but sometimes it isn't. In this case, packagers are required to add AppStream metainfo themselves."}),"\n",(0,i.jsx)(t.p,{children:"Generally, for graphical applications, a package must provide one appstream metainfo file, an icon file, and a .desktop file for AppStream composition to succeed. However, there are exceptions to this. For example, metainfo for a font package does not need a .desktop file or icons. An application may provide more than one metainfo file."}),"\n",(0,i.jsx)(t.h2,{id:"a-short-note-on-terminology",children:"A short note on terminology"}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.em,{children:"AppStream"})," is the specification. ",(0,i.jsx)(t.em,{children:"Metainfo"})," is provided by individual projects, but may also be referred to as metadata; the legacy name for this is ",(0,i.jsx)(t.em,{children:"AppData"}),". AppStream composes multiple metainfo sources in a single ",(0,i.jsx)(t.em,{children:"catalog"}),"; this also may be referred to as metadata. Catalogs are used by software centers to display information about projects (e.g. desktop application, font, etc.). Catalogs from multiple different sources be can installed and leveraged at the same time by software centers."]}),"\n",(0,i.jsx)(t.h2,{id:"adding-appstream-metainfo-to-an-existing-package",children:"Adding appstream metainfo to an existing package"}),"\n",(0,i.jsx)(t.p,{children:"There are a few scenarios that Packagers might encounter:"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"No"}),(0,i.jsx)(t.th,{children:"Scenario"}),(0,i.jsx)(t.th,{children:"Solution"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"1"}),(0,i.jsx)(t.td,{children:"An application already provides appstream metainfo"}),(0,i.jsx)(t.td,{children:"Nothing to do"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"2"}),(0,i.jsx)(t.td,{children:"An application contains appstream metainfo in the source package but we do not install it"}),(0,i.jsxs)(t.td,{children:["Install the appstream metainfo to ",(0,i.jsx)(t.code,{children:"/usr/share/metainfo"}),". ",(0,i.jsx)(t.em,{children:"Example"}),": ",(0,i.jsx)(t.a,{href:"https://github.com/getsolus/packages/commit/0a726a53454e7c8a6b0e66de69d59bcc66f0fc19",children:"here"})]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"3"}),(0,i.jsx)(t.td,{children:"An application doesn't contain appstream metainfo in the source package but it exists on Flathub"}),(0,i.jsxs)(t.td,{children:["Borrow and tweak the appstream metainfo from the Flathub repo. Encourage upstream project to add it to their source. ",(0,i.jsx)(t.em,{children:"Example"}),": ",(0,i.jsx)(t.a,{href:"https://github.com/getsolus/packages/commit/da2f65b93f412da43d1db9edbcb08bb90517a0eb",children:"here"})]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"4"}),(0,i.jsx)(t.td,{children:"An application doesn't provide appstream metainfo and it doesn't exist on flathub"}),(0,i.jsxs)(t.td,{children:["See ",(0,i.jsx)(t.a,{href:"#writing-appstream-metainfo",children:"here"}),". ",(0,i.jsx)(t.em,{children:"Example"}),": ",(0,i.jsx)(t.a,{href:"https://github.com/getsolus/packages/commit/414219d8b2ceeabe85178d3a467f81b9131016f4",children:"here"})]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"5"}),(0,i.jsx)(t.td,{children:"Appstream metainfo is provided but composition of it is failing"}),(0,i.jsxs)(t.td,{children:["See ",(0,i.jsx)(t.a,{href:"#testing-appstream-metainfo",children:"here"}),". ",(0,i.jsx)(t.em,{children:"Example"}),": ",(0,i.jsx)(t.a,{href:"https://github.com/getsolus/packages/commit/583b7c742caf50e2f66a70e9b62e9b91566c03f5",children:"here"}),"."]})]})]})]}),"\n",(0,i.jsxs)(t.p,{children:["AppStream metainfo is to be installed in the ",(0,i.jsx)(t.code,{children:"/usr/share/metainfo/"})," directory. It must be placed in the package which should be installed in order to get the software described by the respective metadata. This means that you might need to move the _.metainfo.xml or _.appdata.xml to the right (sub)package."]}),"\n",(0,i.jsx)(t.p,{children:'In case your AppStream metainfo is describing a desktop application (you can tell by the XML root-node having a type="desktop-application" or type="desktop" attribute), the .metainfo.xml file must be placed in the same package as the .desktop file already is, which (as above) must be the package containing the application itself.'}),"\n",(0,i.jsx)(t.h2,{id:"testing-appstream-metainfo",children:"Testing appstream metainfo"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Clone the package repo"}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Build it or fetch the package e.g. ",(0,i.jsx)(t.code,{children:"eopkg fetch sunshine"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Extract the package e.g. ",(0,i.jsx)(t.code,{children:"uneopkg sunshine-0.23.1-15-1-x86_64.eopkg"}),". This will unzip the ",(0,i.jsx)(t.code,{children:".eopkg"})," file containing the ",(0,i.jsx)(t.code,{children:"metainfo.xml"})," and ",(0,i.jsx)(t.code,{children:"files.xml"})," meta information as well as extract the contained ",(0,i.jsx)(t.code,{children:"install.tar.xz"})," archive to a folder called ",(0,i.jsx)(t.code,{children:"install"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Ensure ",(0,i.jsx)(t.code,{children:"appstreamcli compose"})," is available, and install it if it's not."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"sudo eopkg it appstream-compose\n"})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Run a report against the extracted install directory."}),"\n",(0,i.jsx)(t.p,{children:"For general testing, the following command should be sufficient:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"appstreamcli compose install/ --hints-dir=hints --verbose\n"})}),"\n",(0,i.jsx)(t.p,{children:"For more advanced testing, such as media generation, e.g. to test font screenshots get auto-generated, run:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"appstreamcli compose install/ --hints-dir=hints --media-dir=media --media-baseurl=localhost:8000 --verbose\n"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["If it reports ",(0,i.jsx)(t.code,{children:"Success!"}),", there is nothing to do."]}),"\n",(0,i.jsx)(t.li,{children:"If it reports warnings, they should be rectified if possible."}),"\n",(0,i.jsx)(t.li,{children:'If it reports errors, they must be rectified so that the metainfo for that package is composed into the catalog. More details can be found in the "hints" folder.'}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["To fix any potential warnings or errors, you can edit the metainfo file in ",(0,i.jsx)(t.code,{children:"install/usr/share/metainfo/"})," then rerun ",(0,i.jsx)(t.code,{children:"appstreamcli compose install/"})," to verify the issues have been rectified. A patch then can be created to be submitted to the upstream project if it provides the metainfo, which can also be applied to the Solus package repository for the corresponding package. If the upstream doesn't provide the metainfo file, then a patch should be submitted directly to the corresponding package in the Solus package repository instead."]}),"\n",(0,i.jsx)(t.h2,{id:"debugging-failures",children:"Debugging failures"}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"appstreamcli compose"})," tool will normally give good hints about failures but the most common issues are:"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["A ",(0,i.jsx)(t.code,{children:".desktop"})," file cannot be matched to the metainfo file.","\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["By default, the ",(0,i.jsx)(t.code,{children:".desktop"})," file name must match the ",(0,i.jsx)(t.code,{children:"<id>"})," provided in ",(0,i.jsx)(t.code,{children:".xml"})," file in ",(0,i.jsx)(t.code,{children:"/usr/share/metainfo/"}),". For example, the if you have ",(0,i.jsx)(t.code,{children:"<id>org.foobar.my_package</id>"})," the ",(0,i.jsx)(t.code,{children:".desktop"})," file should be called ",(0,i.jsx)(t.code,{children:"org.foobar.my_package.desktop"}),". However, there is an exception to this if the metainfo provides a launchable tag. For example, if the metainfo contains ",(0,i.jsx)(t.code,{children:'<launchable type="desktop-id">my_package.desktop</launchable>'})," then the ",(0,i.jsx)(t.code,{children:".desktop"})," file can be just called ",(0,i.jsx)(t.code,{children:"my_package.desktop"}),". For more information view the upstream documentation ",(0,i.jsx)(t.a,{href:"https://www.freedesktop.org/software/appstream/docs/sect-Metadata-Application.html#spec-appdata-introduction",children:"here"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["No metainfo file is provided.","\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["No appstream metainfo was found in ",(0,i.jsx)(t.code,{children:"/usr/share/metainfo/"}),"."]}),"\n",(0,i.jsxs)(t.li,{children:["Appstream metainfo may exist in ",(0,i.jsx)(t.code,{children:"/usr/share/appdata/"})," but that path is now obsolete and is no longer read from."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["No icon found.","\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Install a icon to a directory respecting the freedesktop icon specification. For ",(0,i.jsx)(t.code,{children:".png"})," files this is ",(0,i.jsx)(t.code,{children:"/usr/share/icons/hicolor/{size}x{size}/apps/"}),". Where size should be at least 64px. For ",(0,i.jsx)(t.code,{children:".svg"})," files this is ",(0,i.jsx)(t.code,{children:"/usr/share/icons/hicolor/scalable/apps/"}),"."]}),"\n",(0,i.jsxs)(t.li,{children:["A icon may be too small to be accepted, it must be at least 64px. Note: that ",(0,i.jsx)(t.code,{children:"appstream-generator"})," is a little more generous and allows 48px icons."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"writing-appstream-metainfo",children:"Writing AppStream metainfo"}),"\n",(0,i.jsx)(t.p,{children:"When the upstream project does not provide any metainfo, and no alternatives exist on platforms such as FlatHub, is it recommended to write the metainfo and submit it to the upstream project. Whilst it is awaiting review upstream, it can be applied downstream to the relevant package."}),"\n",(0,i.jsx)(t.p,{children:"There are some existing tools to help you write metainfo from scratch:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"https://www.freedesktop.org/software/appstream/metainfocreator/#/",children:"https://www.freedesktop.org/software/appstream/metainfocreator/#/"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"https://flathub.org/apps/page.codeberg.JakobDev.jdAppStreamEdit",children:"https://flathub.org/apps/page.codeberg.JakobDev.jdAppStreamEdit"})}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["These tools should prompt you with enough information to create valid metainfo, but to double check, you may run the validate tool provided by the ",(0,i.jsx)(t.code,{children:"appstream"})," package. To validate the metainfo you've created, run ",(0,i.jsx)(t.code,{children:"appstreamcli validate my_package_metainfo.xml"}),"."]}),"\n",(0,i.jsx)(t.admonition,{type:"note",children:(0,i.jsx)(t.p,{children:"It is not necessary to pass all pedantic warnings, but all errors must be rectified."})}),"\n",(0,i.jsxs)(t.h2,{id:"running-appstream-generator",children:["Running ",(0,i.jsx)(t.code,{children:"appstream-generator"})]}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"appstream-generator"})," is a tool that supports composing a catalog against complex data sources. For our purposes, it provides a backend for Solus that understands a repository managed by ",(0,i.jsx)(t.code,{children:"eopkg"}),", as well as individual ",(0,i.jsx)(t.code,{children:".eopkg"})," files themselves. Individual packagers are unlikely to need to use this tool, unless they are managing a medium to long term repository that they need an appstream catalog for."]}),"\n",(0,i.jsxs)(t.p,{children:["To generate a catalog with appstream generator, a ",(0,i.jsx)(t.code,{children:"asgen-config.json"})," file must be provided."]}),"\n",(0,i.jsx)(t.p,{children:"Here is a example configuration file for running against local repositories."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-json",children:'{\n    "ProjectName": "Solus",\n    "ArchiveRoot": "/var/lib/solbuild",\n    "MediaBaseUrl": "http://localhost:8000/export/media",\n    "HtmlBaseUrl": "http://localhost:8000/export/html",\n    "Backend": "solus",\n    "Suites": {\n        "local": {\n            "sections": ["main"],\n            "architectures": ["x86_64"]\n        }\n    }\n}\n'})}),"\n",(0,i.jsxs)(t.p,{children:["A local repository should contain a ",(0,i.jsx)(t.code,{children:"eopkg-index.xml"})," file as well as ",(0,i.jsx)(t.code,{children:".eopkg"})," files. Remember to run, ",(0,i.jsx)(t.code,{children:"eopkg index --skip-signing"})," in the root of the local repository before starting to ensure the index is up to date. For the sample provided above, the eopkg index file should reside in ",(0,i.jsx)(t.code,{children:"/var/lib/solbuild/local/eopkg-index.xml"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["To generate the catalog run ",(0,i.jsx)(t.code,{children:"appstream-generator run local --verbose"}),". Depending on the size of the repository, this may take a long time; subsequent runs will take far less time."]}),"\n",(0,i.jsxs)(t.p,{children:["To view the HTML report, you can start a http server with ",(0,i.jsx)(t.code,{children:"python3 -m http.server 8000"}),", enter ",(0,i.jsx)(t.code,{children:"http://localhost:8000/"})," in your web browser, then navigate to ",(0,i.jsx)(t.code,{children:"export/html/"}),"."]}),"\n",(0,i.jsx)(t.p,{children:"It can also be ran against a remote repository, here is a sample configuration."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-json",children:'{\n    "ProjectName": "Solus",\n    "ArchiveRoot": "https://fastly.getsol.us/repo",\n    "MediaBaseUrl": "https://appstream.getsol.us/media",\n    "HtmlBaseUrl": "https://appstream.getsol.us",\n    "Backend": "solus",\n    "Suites": {\n        "gwendraeth": {\n            "sections": ["main"],\n            "architectures": ["x86_64"]\n        },\n        "gwendraeth-updates": {\n            "sections": ["main"],\n            "architectures": ["x86_64"],\n            "dataPriority": 10,\n            "baseSuite": "gwendraeth"\n        }\n    }\n}\n'})}),"\n",(0,i.jsxs)(t.p,{children:["In this example, ",(0,i.jsx)(t.code,{children:"appstream-generator"}),' will run against two suites which correspond to the "gwendraeth" and "gwendraeth-updates" repositories, where the index URL for "gwendraeth" would correspond to ',(0,i.jsx)(t.code,{children:"https://fastly.getsol.us/repo/gwendraeth/eopkg-index.xml.xz"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["To generate a catalog for just gwendraeth, run ",(0,i.jsx)(t.code,{children:"appstream-generator run gwendraeth --verbose"}),". To generate a catalog against gwendraeth ",(0,i.jsx)(t.em,{children:"as well as"})," any differences in the gwendraeth-updates repository, run ",(0,i.jsx)(t.code,{children:"appstream-generator run gwendraeth-updates --verbose"}),". Appstream generator is smart enough to only process ",(0,i.jsx)(t.code,{children:".eopkg"}),' files that are different in the "gwendraeth-updates" repository.']}),"\n",(0,i.jsxs)(t.p,{children:["For more documentation, consult ",(0,i.jsx)(t.a,{href:"https://github.com/ximion/appstream-generator/tree/master/docs",children:"upstream documentation"}),"."]})]})}function p(e={}){let{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},84429:function(e,t,a){a.d(t,{R:()=>o,x:()=>r});var n=a(96540);let i={},s=n.createContext(i);function o(e){let t=n.useContext(s);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),n.createElement(s.Provider,{value:t},e.children)}}}]);